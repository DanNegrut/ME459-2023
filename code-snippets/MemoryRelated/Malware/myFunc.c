#include <string.h>

#define NBYTES 10000
typedef struct {
  /// some long array, that will load in it data that I'm not supposed to see
  char malwareData[NBYTES];
} malwareStruct;

/**
The idea of this function is to do a cast and read a number of n_elements from
that array. Yet since you can access out of bounds, you can do nasty things,
e.g., reading from deep into memory from locations where you have no business
reading.
*/
void callableFunc(void *arrayIn, unsigned int n_elements) {
  /// the expectation is that a pointer to int is sent in
  malwareStruct *pNasty = (malwareStruct *)(arrayIn);

  // this is messing up the very first integer in the legitArray
  pNasty->malwareData[0] = 'd';

  // this can get more malicious, reading now from deep into memory
  // this is reading a block of 5000 bytes from the beginning of legitArray.
  // Recall that legitArray was an array that stores two ints
  char siphon[NBYTES];
  memcpy(siphon, pNasty->malwareData, NBYTES * sizeof(char));

  // the next malware step: using siphon-ed data to probe what is stored deep in
  // the memory. The hacker hopes that he/she lands on a region of memory where
  // important data is stored: passwords, SSN, etc.
}
